<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Dashboard - Home Car Rental</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header>
        <div class="logo-container">
            <span>Home Car Rental - Vendor Panel</span>
        </div>
        <nav>
            <a href="/vendor/dashboard.html">My Bookings</a>
            <a href="/vendor/profile.html">My Profile</a>
            <a href="/api/logout">Logout</a>
        </nav>
    </header>
    <main>
        <section style="padding: 2rem;">
            <h1>My Assigned Bookings</h1>
            <div id="bookings-container">
                <!-- Bookings will be loaded here -->
            </div>
        </section>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const bookingsContainer = document.getElementById('bookings-container');
            const statuses = ['Pending', 'Confirmed', 'Completed', 'Cancelled'];

            function renderBookings(bookings) {
                if (bookings.length === 0) {
                    bookingsContainer.innerHTML = '<p>No bookings found.</p>';
                    return;
                }
                const table = document.createElement('table');
                table.className = 'bookings-table';
                const thead = document.createElement('thead');
                thead.innerHTML = `<tr><th>ID</th><th>Customer</th><th>Trip</th><th>Date/Time</th><th>Status</th><th>Action</th></tr>`;
                table.appendChild(thead);
                const tbody = document.createElement('tbody');
                bookings.forEach(booking => {
                    const tr = document.createElement('tr');
                    const statusOptions = statuses.map(s => `<option value="${s}" ${s === booking.status ? 'selected' : ''}>${s}</option>`).join('');
                    tr.innerHTML = `
                        <td>${booking.id}</td>
                        <td>${booking.name}<br><small>${booking.mobile}</small></td>
                        <td>${booking.pickup} to ${booking.drop}</td>
                        <td>${booking.date} at ${booking.time}</td>
                        <td><select class="status-select">${statusOptions}</select></td>
                        <td><button class="update-btn" data-id="${booking.id}">Update</button></td>
                    `;
                    tbody.appendChild(tr);
                });
                table.appendChild(tbody);
                bookingsContainer.innerHTML = '';
                bookingsContainer.appendChild(table);
            }

            function fetchBookings() {
                fetch('/api/vendor/bookings').then(res => res.json()).then(renderBookings);
            }

            bookingsContainer.addEventListener('click', e => {
                if (e.target.classList.contains('update-btn')) {
                    const id = e.target.dataset.id;
                    const status = e.target.closest('tr').querySelector('.status-select').value;
                    fetch(`/api/vendor/bookings/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ status })
                    }).then(res => {
                        if (res.ok) alert('Status updated!');
                        else alert('Update failed.');
                    });
                }
            });

            fetchBookings();
        });
    </script>
</body>
</html>
